"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),r=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),t=require("react"),n=require("react-dom"),o=require("three"),i=require("@react-three/fiber");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var u=a(e),c=a(r),l=s(t),d=s(n),f=new o.Vector3,p=new o.Vector3,m=new o.Vector3;function h(e,r,t){var n=f.setFromMatrixPosition(e.matrixWorld);n.project(r);var o=t.width/2,i=t.height/2;return[n.x*o+o,-n.y*i+i]}var v=function(e){return Math.abs(e)<1e-10?0:e};function x(e,r,t){void 0===t&&(t="");for(var n="matrix3d(",o=0;16!==o;o++)n+=v(r[o]*e.elements[o])+(15!==o?",":")");return t+n}var y,b=(y=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],function(e){return x(e,y)}),g=function(e,r){return x(e,[1/(t=r),1/t,1/t,1,-1/t,-1/t,-1/t,-1,1/t,1/t,1/t,1,1,1,1,1],"translate(-50%,-50%)");var t},M=l.forwardRef((function(e,r){var t,n=e.children,a=e.eps,s=void 0===a?.001:a,x=e.style,y=e.className,M=e.prepend,P=e.center,W=e.fullscreen,w=e.portal,E=e.distanceFactor,O=e.sprite,j=void 0!==O&&O,F=e.transform,T=void 0!==F&&F,C=e.occlude,R=e.onOcclude,z=e.zIndexRange,I=void 0===z?[16777271,0]:z,q=e.calculatePosition,N=void 0===q?h:q,_=e.as,A=void 0===_?"div":_,V=e.pointerEvents,k=void 0===V?"auto":V,D=c.default(e,["children","eps","style","className","prepend","center","fullscreen","portal","distanceFactor","sprite","transform","occlude","onOcclude","zIndexRange","calculatePosition","as","pointerEvents"]),L=i.useThree((function(e){return e.gl})),S=i.useThree((function(e){return e.camera})),H=i.useThree((function(e){return e.scene})),Z=i.useThree((function(e){return e.size})),B=i.useThree((function(e){return e.raycaster})),G=l.useState((function(){return document.createElement(A)}))[0],J=l.useRef(null),K=l.useRef(0),Q=l.useRef([0,0]),U=l.useRef(null),X=l.useRef(null),Y=null!==(t=null==w?void 0:w.current)&&void 0!==t?t:L.domElement.parentNode;l.useEffect((function(){if(J.current){if(H.updateMatrixWorld(),T)G.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{var e=N(J.current,S,Z);G.style.cssText="position:absolute;top:0;left:0;transform:translate3d("+e[0]+"px,"+e[1]+"px,0);transform-origin:0 0;"}return Y&&(M?Y.prepend(G):Y.appendChild(G)),function(){Y&&Y.removeChild(G),d.unmountComponentAtNode(G)}}}),[Y,T]);var $=l.useMemo((function(){return T?{position:"absolute",top:0,left:0,width:Z.width,height:Z.height,transformStyle:"preserve-3d",pointerEvents:"none"}:u.default({position:"absolute",transform:P?"translate3d(-50%,-50%,0)":"none"},W&&{top:-Z.height/2,left:-Z.width/2,width:Z.width,height:Z.height},x)}),[x,P,W,Z,T]),ee=l.useMemo((function(){return{position:"absolute",pointerEvents:k}}),[k]);l.useLayoutEffect((function(){T?d.render(l.createElement("div",{ref:U,style:$},l.createElement("div",{ref:X,style:ee},l.createElement("div",{ref:r,className:y,style:x,children:n}))),G):d.render(l.createElement("div",{ref:r,style:$,className:y,children:n}),G)}));var re=l.useRef(!0);return i.useFrame((function(){if(J.current){S.updateMatrixWorld(),J.current.updateWorldMatrix(!0,!1);var e=T?Q.current:N(J.current,S,Z);if(T||Math.abs(K.current-S.zoom)>s||Math.abs(Q.current[0]-e[0])>s||Math.abs(Q.current[1]-e[1])>s){var r=function(e,r){var t=f.setFromMatrixPosition(e.matrixWorld),n=p.setFromMatrixPosition(r.matrixWorld),o=t.sub(n),i=r.getWorldDirection(m);return o.angleTo(i)>Math.PI/2}(J.current,S),t=!1;"boolean"==typeof C?!0===C&&(t=[H]):Array.isArray(C)&&(t=C.map((function(e){return e.current})));var n=re.current;if(t){var i=function(e,r,t,n){var o=f.setFromMatrixPosition(e.matrixWorld),i=o.clone();i.project(r),t.setFromCamera(i,r);var a=t.intersectObjects(n,!0);if(a.length){var s=a[0].distance;return o.distanceTo(t.ray.origin)<s}return!0}(J.current,S,B,t);re.current=i&&!r}else re.current=!r;if(n!==re.current&&(R?R(!re.current):G.style.display=re.current?"block":"none"),G.style.zIndex=""+function(e,r,t){if(r instanceof o.PerspectiveCamera||r instanceof o.OrthographicCamera){var n=f.setFromMatrixPosition(e.matrixWorld),i=p.setFromMatrixPosition(r.matrixWorld),a=n.distanceTo(i),s=(t[1]-t[0])/(r.far-r.near),u=t[1]-s*r.far;return Math.round(s*a+u)}}(J.current,S,I),T){var a=Z.width/2,u=Z.height/2,c=S.projectionMatrix.elements[5]*u,l=S,d=l.isOrthographicCamera,h=l.top,x=l.left,y=l.bottom,M=l.right,P=b(S.matrixWorldInverse),W=d?"scale("+c+")translate("+v(-(M+x)/2)+"px,"+v((h+y)/2)+"px)":"translateZ("+c+"px)",w=J.current.matrixWorld;j&&((w=S.matrixWorldInverse.clone().transpose().copyPosition(w).scale(J.current.scale)).elements[3]=w.elements[7]=w.elements[11]=0,w.elements[15]=1),G.style.width=Z.width+"px",G.style.height=Z.height+"px",G.style.perspective=d?"":c+"px",U.current&&X.current&&(U.current.style.transform=""+W+P+"translate("+a+"px,"+u+"px)",X.current.style.transform=g(w,1/((E||10)/400)))}else{var O=void 0===E?1:function(e,r){if(r instanceof o.OrthographicCamera)return r.zoom;if(r instanceof o.PerspectiveCamera){var t=f.setFromMatrixPosition(e.matrixWorld),n=p.setFromMatrixPosition(r.matrixWorld),i=r.fov*Math.PI/180,a=t.distanceTo(n);return 1/(2*Math.tan(i/2)*a)}return 1}(J.current,S)*E;G.style.transform="translate3d("+e[0]+"px,"+e[1]+"px,0) scale("+O+")"}Q.current=e,K.current=S.zoom}}})),l.createElement("group",u.default({},D,{ref:J}))}));exports.Html=M;
