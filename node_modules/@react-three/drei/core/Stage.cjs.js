"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),t=require("react"),r=require("three"),n=require("@react-three/fiber"),i=require("./Environment.cjs.js"),a=require("./ContactShadows.cjs.js");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}require("three-stdlib"),require("use-asset"),require("../helpers/environment-assets.cjs.js"),require("@babel/runtime/helpers/extends");var u=o(e),c=s(t),l=s(r),d={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};exports.Stage=function(e){var t=e.children,r=e.controls,o=e.shadows,s=void 0===o||o,h=e.adjustCamera,f=void 0===h||h,m=e.environment,p=void 0===m?"city":m,v=e.contactShadow,b=void 0===v||v,w=e.intensity,y=void 0===w?1:w,g=e.preset,j=void 0===g?"rembrandt":g,E=e.shadowBias,S=void 0===E?0:E,x=e.contactShadowBlur,q=void 0===x?2:x,O=e.contactShadowOpacity,B=void 0===O?.5:O,L=u.default(e,["children","controls","shadows","adjustCamera","environment","contactShadow","intensity","preset","shadowBias","contactShadowBlur","contactShadowOpacity"]),C=d[j],M=n.useThree((function(e){return e.camera})),P=n.useThree((function(e){return e.controls})),_=c.useRef(null),k=c.useRef(null),z=c.useState({radius:0,width:0,height:0}),R=z[0],T=R.radius,W=R.width,A=R.height,D=z[1];return c.useLayoutEffect((function(){_.current.position.set(0,0,0),_.current.updateWorldMatrix(!0,!0);var e=(new l.Box3).setFromObject(k.current),t=new l.Vector3,r=new l.Sphere,n=e.max.y-e.min.y,i=e.max.x-e.min.x;e.getCenter(t),e.getBoundingSphere(r),D({radius:r.radius,width:i,height:n}),_.current.position.set(-t.x,-t.y+n/2,-t.z)}),[t]),c.useLayoutEffect((function(){if(f){var e=T/(A>W?1.5:2.5);M.position.set(0,.5*T,2.5*T),M.near=.1,M.far=Math.max(5e3,4*T),M.lookAt(0,e,0);var t=P||(null==r?void 0:r.current);t&&(t.target.set(0,e,0),t.update())}}),[P,T,A,W,f]),c.createElement("group",L,c.createElement("group",{ref:_},c.createElement("group",{ref:k},t)),b&&c.createElement(a.ContactShadows,{"rotation-x":Math.PI/2,opacity:B,width:2*T,height:2*T,blur:q,far:T/2}),p&&c.createElement(i.Environment,{preset:p}),c.createElement("ambientLight",{intensity:y/3}),c.createElement("spotLight",{penumbra:1,position:[C.main[0]*T,C.main[1]*T,C.main[2]*T],intensity:2*y,castShadow:s,"shadow-bias":S}),c.createElement("pointLight",{position:[C.fill[0]*T,C.fill[1]*T,C.fill[2]*T],intensity:y}))};
