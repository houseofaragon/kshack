"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),r=require("@react-three/fiber"),t=require("three"),n=require("./OrthographicCamera.cjs.js"),u=require("./useCamera.cjs.js");function o(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}require("@babel/runtime/helpers/extends"),require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),require("react-merge-refs");var a=o(e),i=a.createContext({}),c=2*Math.PI,s=new t.Object3D,l=new t.Matrix4,f=new t.Quaternion,p=new t.Quaternion,d=new t.Vector3,h=new t.Vector3;exports.GizmoHelper=function(e){var o=e.alignment,m=void 0===o?"bottom-right":o,g=e.margin,b=void 0===g?[80,80]:g,v=e.onUpdate,y=e.onTarget,w=e.children,j=r.useThree((function(e){return e.size})),q=r.useThree((function(e){return e.camera})),x=r.useThree((function(e){return e.controls})),O=r.useThree((function(e){return e.gl})),T=r.useThree((function(e){return e.scene})),C=r.useThree((function(e){return e.invalidate})),k=a.useRef(),P=a.useRef(),R=a.useRef(null),z=a.useState((function(){return new t.Scene}))[0],E=a.useRef(!1),M=a.useRef(0),D=a.useRef(new t.Vector3(0,0,0));a.useEffect((function(){return T.background&&(k.current=T.background,T.background=null,z.background=k.current),function(){k.current&&(T.background=k.current)}}),[]);r.useFrame((function(e,r){var t;R.current&&P.current&&(!function(e){if(E.current)if(f.angleTo(p)<.01)E.current=!1;else{var r=e*c;f.rotateTowards(p,r),q.position.set(0,0,1).applyQuaternion(f).multiplyScalar(M.current).add(D.current),q.up.set(0,1,0).applyQuaternion(f).normalize(),q.quaternion.copy(f),v?v():x&&x.update(),C()}}(r),l.copy(q.matrix).invert(),null==(t=P.current)||t.quaternion.setFromRotationMatrix(l),O.autoClear=!1,O.clearDepth(),O.render(z,R.current))}));var Q={tweenCamera:function(e){E.current=!0,(x||y)&&(D.current=(null==x?void 0:x.target)||(null==y?void 0:y())),M.current=q.position.distanceTo(d),f.copy(q.quaternion),h.copy(e).multiplyScalar(M.current).add(d),s.lookAt(h),p.copy(s.quaternion),C()},raycast:u.useCamera(R)},S=b[0],_=b[1],V=m.endsWith("-left")?-j.width/2+S:j.width/2-S,W=m.startsWith("top-")?j.height/2-_:-j.height/2+_;return r.createPortal(a.createElement(i.Provider,{value:Q},a.createElement(n.OrthographicCamera,{ref:R,makeDefault:!1,position:[0,0,200]}),a.createElement("group",{ref:P,position:[V,W,0]},w)),z)},exports.useGizmoContext=function(){return a.useContext(i)};
